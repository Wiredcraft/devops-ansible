---
# NOTE - not tested !
# NOTE - currently require a file with the credentials
# Can not provide the API keys in CLI...
- name: Ensure Rackspace server
  local_action:
    module: rax 
    image: ${image}
    flavor: ${size}
    region: ${region}
    name: "${inventory_hostname}"
    # key_name:
    wait: yes
    wait_timeout: 500
  register: response
- name: Register new IP address for Rackspace server
  local_action:
    module: set_fact
    ansible_ssh_host: {{ response }}
- name: Wait for SSH to be reachable
  local_action:
    module: wait_for
    delay: 60
    host: {{ ansible_ssh_host }}
    port: 22
    timeout: 300