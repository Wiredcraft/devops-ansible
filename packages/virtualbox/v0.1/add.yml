---
- name: Ensure VirtualBox APT repo
  apt_repository: state=present
      repo="deb http://download.virtualbox.org/virtualbox/debian $ansible_distribution_release contrib"
  register: virtualbox_apt

- name: Refresh APT repo to handle VirtualBox
  apt: update_cache=yes
  only_if: ${virtualbox_apt.changed}

- name: Ensure VirtualBox APT key
  apt_key: state=present url=http://download.virtualbox.org/virtualbox/debian/oracle_vbox.asc

- name: Ensure VirtualBox and dependencies are present
  apt: state=present pkg=$item
  with_items:
    - virtualbox-4.2
    - dkms
