---
# Java requirements
- name: Ensure java 
  apt: name=openjdk-7-jre-headless state=present

# Elasticsearch
- name: Retrieve Elasticsearch
  get_url: 
    url=https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.0.0.deb
    dest=/opt/elasticsearch-1.0.0.deb

# Install java from the java service
- include: DEVOPS_BASE/services/java/latest/add.yml

- name: Install Elasticsearch
  command: dpkg -i /opt/elasticsearch-1.0.0.deb

- name: ensure the elasticsearch default file
  template:
    src=DEVOPS_PACKAGE/templates/default_elasticsearch.j2
    dest=/etc/default/elasticsearch
    owner=root
    group=root
    mode=0644
  notify: restart elasticsearch

- name: ensure the elasticsearch config file
  template:
    src=DEVOPS_PACKAGE/templates/elasticsearch.yml.j2
    dest=/etc/elasticsearch/elasticsearch.yml
    owner=root
    group=root
    mode=0644
  notify: restart elasticsearch

# Ensure running
- include: DEVOPS_PACKAGE/tasks/start.yml
