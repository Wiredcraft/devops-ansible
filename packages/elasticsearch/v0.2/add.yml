---
- name: Ensure Elasticsearch repo GPG key
  apt_key:
    url=http://packages.elasticsearch.org/GPG-KEY-elasticsearch
    state=present

- name: Ensure Elasticsearch repo is installed
  apt_repository:
    repo='deb http://packages.elasticsearch.org/elasticsearch/1.0/debian stable main'
    state=present

- name: Ensure Elasticsearch is installed
  apt:
    name=elasticsearch
    state=present
    update_cache=yes
  notify: enable elasticsearch

- name: ensure the elasticsearch default file
  template:
    src=DEVOPS_PACKAGE/templates/default_elasticsearch.j2
    dest=/etc/default/elasticsearch
    owner=root
    group=root
    mode=0644
  notify: restart elasticsearch

- name: ensure the elasticsearch config file
  template:
    src=DEVOPS_PACKAGE/templates/elasticsearch.yml.j2
    dest=/etc/elasticsearch/elasticsearch.yml
    owner=root
    group=root
    mode=0644
  notify: restart elasticsearch

# Ensure running
- include: DEVOPS_PACKAGE/tasks/start.yml
