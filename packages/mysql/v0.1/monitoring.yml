---
- name: Ensure mysql monitoring user exists
  mysql_user: 
    name=monitoring
    password=${item}
    priv=*.*:USAGE,REPLICATION CLIENT
    state=present
  with_password:
    DEVOPS_BASE/spaces/${space}/${inventory_hostname}/mysql_monitoring_password
    length=20

- name: Ensure mysql collectd plugin is enabled
  template: 
    src=DEVOPS_PACKAGE/templates/collectd-mysql.j2
    dest=/etc/collectd/plugins.d/mysql
    owner=root
    group=root
    mode=0644
  with_password:
    DEVOPS_BASE/spaces/${space}/${inventory_hostname}/mysql_monitoring_password
    length=20
  notify: reload collectd
